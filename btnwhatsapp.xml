<?xml version="1.0" encoding="UTF-8"?>
<extension type="plugin" group="system" method="upgrade" version="4.0">

    <name>System - WhatsApp Button</name>

    <author>Hirlei Carlos Pereira de Araújo</author>
    <authorEmail>prof.hirleicarlos@gmail.com</authorEmail>
    <authorUrl>https://hirleicarlos.github.io/</authorUrl>

    <creationDate>2026-02-15</creationDate>
    <version>2.0.0</version>

    <copyright>(C) 2026 Hirlei Carlos Pereira de Araújo</copyright>
    <license>GNU General Public License version 2 or later</license>

    <description>PLG_SYSTEM_BTNWHATSAPP_DESC</description>

    <namespace path="src">Joomla\Plugin\System\Btnwhatsapp</namespace>

    <!-- OBRIGATÓRIO PARA JED -->
    <updateservers>
        <server type="extension" priority="1" name="System - WhatsApp Button">
            https://hirleicarlos.github.io/updates/plg_system_btnwhatsapp.xml
        </server>
    </updateservers>

    <files>
        <filename plugin="btnwhatsapp">btnwhatsapp.php</filename>
        <folder>src</folder>
        <folder>services</folder>
        <folder>layouts</folder>
        <folder>language</folder>
        <filename>index.html</filename>
    </files>

    <media folder="media" destination="plg_system_btnwhatsapp">
        <folder>css</folder>
        <filename>index.html</filename>
    </media>

    <languages>
        <language tag="en-GB">language/en-GB/en-GB.plg_system_btnwhatsapp.ini</language>
        <language tag="en-GB">language/en-GB/en-GB.plg_system_btnwhatsapp.sys.ini</language>

        <language tag="pt-BR">language/pt-BR/pt-BR.plg_system_btnwhatsapp.ini</language>
        <language tag="pt-BR">language/pt-BR/pt-BR.plg_system_btnwhatsapp.sys.ini</language>
    </languages>

    <config>
        <fields name="params">

            <!-- ================= BASIC ================= -->
            <fieldset name="basic" label="PLG_SYSTEM_BTNWHATSAPP_FIELDSET_BASIC">
                <field
                        name="enabled"
                        type="radio"
                        default="0"
                        label="PLG_SYSTEM_BTNWHATSAPP_ENABLED_LABEL"
                        class="btn-group btn-group-yesno">
                    <option value="1">JYES</option>
                    <option value="0">JNO</option>
                </field>
            </fieldset>

            <!-- ================= WHATSAPP ================= -->
            <fieldset name="whatsapp" label="PLG_SYSTEM_BTNWHATSAPP_FIELDSET_WHATSAPP">

                <field
                        name="phone"
                        type="text"
                        required="true"
                        label="PLG_SYSTEM_BTNWHATSAPP_PHONE_LABEL"
                        description="PLG_SYSTEM_BTNWHATSAPP_PHONE_DESC" />

                <field
                        name="message"
                        type="textarea"
                        required="true"
                        label="PLG_SYSTEM_BTNWHATSAPP_MESSAGE_LABEL"
                        description="PLG_SYSTEM_BTNWHATSAPP_MESSAGE_DESC"
                        hint="PLG_SYSTEM_BTNWHATSAPP_MESSAGE_HINT"
                        default="Olá! Estou nesta página: {url}" />

                <field
                        type="note"
                        class="alert alert-info"
                        description="PLG_SYSTEM_BTNWHATSAPP_MESSAGE_NOTE" />

                <field
                        name="position"
                        type="list"
                        default="end"
                        label="PLG_SYSTEM_BTNWHATSAPP_POSITION_LABEL">
                    <option value="end">PLG_SYSTEM_BTNWHATSAPP_POSITION_END</option>
                    <option value="start">PLG_SYSTEM_BTNWHATSAPP_POSITION_START</option>
                </field>

            </fieldset>

            <!-- ================= DISPLAY ================= -->
            <fieldset name="display" label="PLG_SYSTEM_BTNWHATSAPP_FIELDSET_DISPLAY">

                <field
                        name="display_mode"
                        type="list"
                        default="all"
                        label="PLG_SYSTEM_BTNWHATSAPP_DISPLAY_MODE_LABEL">
                    <option value="all">PLG_SYSTEM_BTNWHATSAPP_DISPLAY_ALL</option>
                    <option value="only">PLG_SYSTEM_BTNWHATSAPP_DISPLAY_ONLY</option>
                    <option value="exclude">PLG_SYSTEM_BTNWHATSAPP_DISPLAY_EXCLUDE</option>
                </field>

                <field
                        name="menu_items"
                        type="sql"
                        multiple="true"
                        layout="joomla.form.field.list-fancy-select"
                        label="PLG_SYSTEM_BTNWHATSAPP_MENU_ITEMS_LABEL"
                        description="PLG_SYSTEM_BTNWHATSAPP_MENU_ITEMS_DESC"
                        showon="display_mode:only,exclude"
                        key_field="value"
                        value_field="text"
                        query="SELECT m.id AS value,
                                  CONCAT(m.title, ' (#', m.id, ')') AS text
                           FROM #__menu AS m
                           WHERE m.client_id = 0
                             AND m.published >= 0
                           ORDER BY m.menutype, m.lft" />

                <field
                        name="device"
                        type="list"
                        default="all"
                        label="PLG_SYSTEM_BTNWHATSAPP_DEVICE_LABEL">
                    <option value="all">PLG_SYSTEM_BTNWHATSAPP_DEVICE_ALL</option>
                    <option value="desktop">PLG_SYSTEM_BTNWHATSAPP_DEVICE_DESKTOP</option>
                    <option value="mobile">PLG_SYSTEM_BTNWHATSAPP_DEVICE_MOBILE</option>
                </field>

            </fieldset>

        </fields>
    </config>

</extension>